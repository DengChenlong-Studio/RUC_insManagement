<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>管理员审批界面</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="stylesheet" href="/static/css/font.css">
    <link rel="stylesheet" href="/static/css/xadmin.css">
    <script src="/static/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="/static/js/xadmin.js"></script>
    <style>
    .fakeimg {
      height: 200px;
      background: #aaa;
    }

    .django_img {
      width: 100%;
      height: 100%;
    }
    .main_box h3 {
      border-left: solid 4px #ae0a29;
      font-size: 18px;
      color: #333;
      line-height: 18px;
      text-indent: 8px;
    }
  </style>
</head>

<body>

<!--<table class="table table-striped">
    <thead>
      <tr>
        <th>申请ID</th>
        <th>提交申请时间</th>
        <th>使用日期</th>
        <th>使用时间</th>
        <th>仪器</th>
        <th>申请人</th>
        <th>申请备注</th>
        <th>操作</th>

      </tr>
    </thead>
    <tbody>
      {% for g in groups %}
      <tr>
        <td>{{g.app_id}}</td>
        <td>{{g.app_datetime}}</td>
        <td>{{g.use_date}}</td>
        <td>{{g.use_time}}</td>
        <td>{{g.ins_id_id}} {{g.name}}</td>
        <td>{{g.sname}}({{g.user_id_id}})</td>
        <td>{{g.comment}}</td>
        <td>
          <button type="button" class="btn btn-danger btn-tongguo" ins="{{g.app_id}}">通过</button>
          <button type="button" class="btn btn-default btn-bohui" ins="{{g.app_id}}">驳回</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
</table>-->
<div class="layui-fluid">
  <div class="layui-row layui-col-space15">
      <div class="layui-col-md12">
          <div class="layui-card">
              <div class="layui-card-body ">
                <br>
                <div class="main_box">
                  <h3> 待审批预约 </h3>
                </div>
                <br>
                  <form class="layui-form layui-col-space5">
                      <div class="layui-inline layui-show-xs-block">
                          <input class="layui-input" autocomplete="off" placeholder="申请序号" name="start" id="start"></div>
                      <div class="layui-inline layui-show-xs-block">
                          <input class="layui-input" autocomplete="off" placeholder="申请时间" name="end" id="end"></div>
                      <div class="layui-inline layui-show-xs-block">
                          <input type="text" name="username" placeholder="仪器名称" autocomplete="off" class="layui-input"></div>
                      <div class="layui-inline layui-show-xs-block">
                          <button class="layui-btn" lay-submit="" lay-filter="sreach">
                              <i class="layui-icon">&#xe615;</i></button>
                      </div>
                      <div class="layui-inline layui-show-xs-block" style="float: right;">
                        <button class="layui-btn" id="print">
                          <i class="layui-icon">&#xe66d;</i></button>
                      </div>
                      <div class="layui-inline layui-show-xs-block" style="float: right;">
                        <button class="layui-btn" id="output">
                          <i class="layui-icon">&#xe67d;</i></button>
                      </div>
                  </form>
              </div>
              <!-- 搜索框结束 -->

              <div class="layui-card-body ">
                  <table class="layui-table" lay-filter="test" id="applist1">
                    <thead>
                      <tr>
                        <th>申请ID</th>
                        <th>提交申请时间</th>
                        <th>使用日期</th>
                        <th>使用时间</th>
                        <th>仪器</th>
                        <th>申请人</th>
                        <th>申请备注</th>
                        <th>通过</th>
                        <th>驳回</th>
                
                      </tr>
                    </thead>
                    <tbody>
                      {% for g in groups %}
                      <tr>
                        <td>{{g.app_id}}</td>
                        <td>{{g.app_datetime}}</td>
                        <td>{{g.use_date}}</td>
                        <td>{{g.use_time}}</td>
                        <td>{{g.ins_id_id}} {{g.name}}</td>
                        <td>{{g.sname}}({{g.user_id_id}})</td>
                        <td>{{g.comment}}</td>
                        <td>
                          <button type="button" class="layui-btn layui-btn btn-tongguo" ins="{{g.app_id}}">通过</button>
                        </td>
                        <td>
                          <button type="button" class="layui-btn layui-btn-danger btn-bohui" ins="{{g.app_id}}">驳回</button>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>

                  <br>
                  <br>
                <div class="main_box">
                  <h3> 已审批预约 </h3>
                </div>
                <form class="layui-form layui-col-space5">
                <div class="layui-inline layui-show-xs-block" style="float: right;">
                  <button class="layui-btn" id="print2">
                    <i class="layui-icon">&#xe66d;</i></button>
                </div>
                <div class="layui-inline layui-show-xs-block" style="float: right;">
                  <button class="layui-btn" id="output2">
                    <i class="layui-icon">&#xe67d;</i></button>
                </div>
              </form>
                <br>
                  <table class="layui-table" lay-filter="test" id="applist2">
                    <thead>
                      <tr>
                        <th>申请ID</th>
                          <th>提交申请时间</th>
                          <th>使用日期</th>
                          <th>使用时间</th>
                          <th>仪器</th>
                          <th>申请人</th>
                          <th>申请备注</th>
                          <th>申请状态</th>
                          <th>查看反馈</th>
                  
                      </tr>
                    </thead>
                    <tbody>
                      {% for g in appgroups %}
                      <tr>
                        <td>{{g.app_id}}</td>
                        <td>{{g.app_datetime}}</td>
                        <td>{{g.use_date}}</td>
                        <td>{{g.use_time}}</td>
                        <td>{{g.ins_id_id}} {{g.name}}</td>
                        <td>{{g.sname}}({{g.user_id_id}})</td>
                        <td>{{g.comment}}</td>
                        <td>{{g.state}}</td>
                        <td>
                          <button type="button" class="layui-btn layui-btn btn-chakanfankui" ins="{{g.app_id}}">查看反馈</button>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>

              </div>
          </div>
      </div>
  </div>
</div>

</body>
<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>

{% include 'manager/manager_get_feedback.html' %}

<script>
    // console.log("?")
    $(".btn-tongguo").click(function(){
      _app_id = $(this).attr("ins")
      $.ajax({
        type:"GET",
        contentType:"application/json;charset=UTF-8",
        url:"/Manager/"+window.location.pathname.match(/\d+/g)+"/approvalapp",
        data:{app_id:_app_id},
        success:function(result){
          console.log("success!")
          console.log(result)
          alert("已同意！")
          window.location.reload()
          /*
          $.ajax({
            url:"/Manager/"+window.location.pathname.match(/\d+/g)+"/applist",
            data:{
                
            },
            type:'get',
            datatype:"html",
            success:function (data) {
                $("#main_content").html(data)
            }
          })*/
        },
        error:function(e){
          console.log(e.status);
          console.log(e.responseText);
        }
      })
    })

    $(".btn-bohui").click(function(){
      _app_id = $(this).attr("ins")
      $.ajax({
        type:"GET",
        contentType:"application/json;charset=UTF-8",
        url:"/Manager/"+window.location.pathname.match(/\d+/g)+"/refuseapp",
        data:{app_id:_app_id},
        success:function(result){
          console.log("success!")
          console.log(result)
          alert("已驳回！")
          window.location.reload()
          /*
          $.ajax({
            url:"/Manager/"+window.location.pathname.match(/\d+/g)+"/applist",
            data:{
                
            },
            type:'get',
            datatype:"html",
            success:function (data) {
                $("#main_content").html(data)
            }
          })*/
        },
        error:function(e){
          console.log(e.status);
          console.log(e.responseText);
        }
      })
    })

    function get_feedback(event){
      console.log(event);
        $.ajax({
            type:"GET",
            contentType:"application/json;charset=UTF-8",
            url:"/Manager/"+window.location.pathname.match(/\d+/g)+"/get_feedback",
            data:{
              "app_id":event.app_id,
            },
            success:function(result){
              console.log("success!")
              console.log(result.feedback)
              var feedback_content=document.getElementById("feedback_comment");
              feedback_content.innerHTML=result.feedback;
            },
            error:function(e){
              console.log(e.status);
              console.log(e.responseText);
            }
        })
    }

    $(".btn-chakanfankui").click(function(){
      jQuery.noConflict();
      $("#get_feedback").modal("show");
      var _app_id = $(this).attr("ins");
      var data = {app_id:_app_id};
      get_feedback(data);
    })
    
    $("#print").click(function(){
    var tableToPrint = document.getElementById('applist1');//将要被打印的表格
    var newWin= window.open("");//新打开一个空窗口
    newWin.document.write(tableToPrint.outerHTML);//将表格添加进新的窗口
    newWin.document.close();//在IE浏览器中使用必须添加这一句
    newWin.focus();//在IE浏览器中使用必须添加这一句

    newWin.print();//打印
    newWin.close();//关闭窗口
  }
  )
  $("#print2").click(function(){
    var tableToPrint = document.getElementById('applist2');//将要被打印的表格
    var newWin= window.open("");//新打开一个空窗口
    newWin.document.write(tableToPrint.outerHTML);//将表格添加进新的窗口
    newWin.document.close();//在IE浏览器中使用必须添加这一句
    newWin.focus();//在IE浏览器中使用必须添加这一句

    newWin.print();//打印
    newWin.close();//关闭窗口
  }
  )
  </script>

</html>